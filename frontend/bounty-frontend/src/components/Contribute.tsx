import React, { useState } from "react";
import { BountyWithName } from "@/services/type";
import { redeemBountyToken } from "@/transactions/bounty_token_redeem";
import { IWallet } from "@meshsdk/core";
// import { insertUnsignedBountyApiRoute } from "@/pages/common/api_common";

interface ContributeProps {
  bounty: BountyWithName;
  wallet: IWallet;
  // bounty: {
  //   name: string;
  //   tasks: string;
  //   reward: string;
  //   required_signatories: string[];
  // };
}

const Contribute: React.FC<ContributeProps> = ({ bounty, wallet }) => {
  const [isModalOpen, setIsModalOpen] = useState(false);

  const handleContributeClick = () => {
    setIsModalOpen(true);
  };

  const handleCloseModal = () => {
    setIsModalOpen(false);
  };

  const handleConfirm = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    try {
      // await insertUnsignedBountyApiRoute(
      //   bounty.name,
      //   "https://github.com/MeshJS/mesh/blob/b651c5d4ba6fc24bf0f09a74b69586a618031870/packages/mesh-provider/src/blockfrost.ts#L483",
      //   new Map([
      //     ["mesh", 100],
      //     ["sidan", 200],
      //   ]),
      //   "84a800d90102838258205c3129c9d8f5e6f1a7a474690626c47c4db198a7e452ba5e64a9ff1f9bc2183f018258205c3129c9d8f5e6f1a7a474690626c47c4db198a7e452ba5e64a9ff1f9bc2183f02825820e08195803180326af946e60ba73e82792379b5cdd594c12e53e25388035e74e7000182a300581d70630b4e9ad1651ff81379d97040639563fa020f50a353fb2d594342ce01821a001e1edca1581cb80aa257a376c9ae7aa0c7a323db88d236e11e0a5ed5e10142da9ea0a14a000643b074657374313101028201d81858b3d8799fa1464769744875625f584068747470733a2f2f6769746875622e636f6d2f4d6573684a532f6d6573682f626c6f622f62363531633564346261366663323462663066303961373462363935583a3836613631383033313837302f7061636b616765732f6d6573682d70726f76696465722f7372632f626c6f636b66726f73742e7473234c343833ff01a144676767301864581c1434db8b992d8bd16ed71c521d0def5811f637d6509d8d4f620ad03eff825839001434db8b992d8bd16ed71c521d0def5811f637d6509d8d4f620ad03ee1041668e7fd16cb2fd97e1995e1016c37f5766f387333c38185f66b821a7caee955a1581cb80aa257a376c9ae7aa0c7a323db88d236e11e0a5ed5e10142da9ea0a14a000de14074657374313101021a0009275e09a1581c389a4efafe5d0b3b16210ae1fe6a4a48a8b13f41e7f913202fa1799ea14467676730200b582063362d465e212bec87fa0b2dce859e1993ade2ebd44343697048a695e81c6da90dd90102818258208f23e23c950c69d0fcc5bda3f0d25fa5f1accc5608f6e2ab8eb8f75f1b11ed4a050ed9010281581cafb8a51e61565cd663fb9e2a970486d82492260ed86e5d677f7b11b212d9010284825820b95ee64a7df219c7b16cdf5b11620ec9495c13d3d7084778c5b4085f4ae9f6ef01825820bda0866e2edc3778191960d4200a982af5530fee8e5c2efc75f6b35e5e54680001825820bda0866e2edc3778191960d4200a982af5530fee8e5c2efc75f6b35e5e54680000825820152ebe680000bd41b86671125015987c642209d7e844b1428e6394daeb17f40300a30081825820ee9f3061a3a5756ad2e25629e69b927b890b137e68d1c25947fc8b7da3b4445258409b3f264ccb21601e8e8a92af9c929d249f15d27b1596e3d1bfdcf88e0e5a72d8b51fe21b87acb0644d2dbeb5d5b30fc8bce161e57e4c4420b2ee374eb664b70f05a38200008240821a00078e951a08ddc76282000282d87a80821a00049f051a05df2acd82010082d87a9f46746573743131ff821a000974531a0c3d6dfa07d9010281590c02590bff010100332323232323232323232323223225333007323232323253323300d3001300f375400426466446464646464646464646464a6660366006603a6ea80044c94ccc0800040644c94ccc084c0900084c8c8c8c94ccc09400400854ccc094c0a00044c94ccc09800400c54ccc098c0a40044c8c94ccc0a00040884c94ccc0a4c0b00084c8c94ccc09d4ccc09c0145288a998142492169735f7265665f746f6b656e5f6e616d655f636f7272656374203f2046616c73650014a02a66604e002294454cc0a124011b69735f626f756e74795f636f6d706c65746564203f2046616c73650014a029414ccc098cdc79bae302c00200d13370e00290008a50375a6056605860580020466eb0c0a8004c8cc004004c8cc004004048894ccc0a800452f5c0264646464660020026eacc0b4010894ccc0bc004400c4c8cc0c4dd3998189ba900533031302e00133031302f0014bd7019801801981980118188009980200218178019bae3029001302c00122533302900114bd7009991299981399981399b8f375c605a004911004a09444cc0b0dd3801198020020008998020020009bac302b001302c001325333023337106e34018004528099b8f3337189000000803244104000643b000371a910104000643b0000033758604e60500060046eb0c098008528198119ba7323300100100d22533302400114bd70099912999811191980080099198008009bab302a302b3027375460546056604e6ea8010894ccc0a400452f5c0264646464660020026eacc0b0010894ccc0b8004400c4c8cc0c0dd3998181ba900533030302d00133030302e0014bd7019801801981900118180009980200218170019bae3028001302b00122533302800114a026644a66604c66e3cdd718160010068a5113300400400137586054002605600226604e00466008008002266008008002604c002604e002660466e9ccc88c8cc00400403c894ccc09800452f5c026644a666048603064a66604a6032604e6ea8004520001375a605660506ea8004c94ccc094c064c09cdd50008a60103d87a8000132330010013756605860526ea8008894ccc0ac004530103d87a8000132333222533302b337220180062a66605666e3c03000c4c05ccc0c0dd400125eb80530103d87a8000133006006001375c60540026eb4c0ac004c0bc008c0b4004c8cc004004dd59815981618141baa302b302c3028375400644a666054002298103d87a8000132333222533302a337220180062a66605466e3c03000c4c058cc0bcdd300125eb80530103d87a8000133006006001375c60520026eacc0a8004c0b8008c0b00044cc0a4008cc0100100044cc010010004c0a0004c0a4004dd7181200119b8a48904000de14000333718900419b80371a0029003800a5eb80dd71811981200080d1bac3022001323300100132330010013756600c60406ea8c018c080dd5181198101baa00322533302200114bd70099191919198008009bab3025004225333027001100313233029374e660526ea4014cc0a4c098004cc0a4c09c0052f5c0660060066056004605200266008008604e0066eb8c084004c090004894ccc08400452f5c026644a66603e66603e66e3cdd718128012441004a09444cc090dd3801198020020008998020020009bac30230013024001153301c49013265787065637420536f6d65286f776e5f696e70757429203d2066696e645f696e70757428696e707574732c20696e7075742900163300500823375e600a603c6ea8004034dd7180f980e1baa323232533301c3004301e3754002264a66666604a0022a66603a600a603e6ea80044c94ccc0880040744c94cccccc09c0040780780780784c8c94ccc0940040804c94cccccc0a80044c94ccc09c0040884c94cccccc0b000408c08c08c08c4c8c94ccc0a80040944c94cccccc0bc0044c94ccc0b000409c4c94cccccc0c400454ccc0b4c0c00084ccc03c0204ccc03c00c4ccc03c00440340a00a00a00a00a00a00a00a0c0b8004c0b8008098098098098c0b0004c0b000cdd700098148009814801010810810810981380098138019bae0013024001302037540020380380380380386464a66603c600c0022a6603e9201274f7261636c6520696e70757420646f6573206e6f7420636f6e7461696e20616e7920646174756d00161533301e3012001153301f4901224f7261636c6520696e70757420646174756d206d75737420626520696e6c696e656400161302430213754004603e6ea8004c088c08cc08cc07cdd51802980f9baa3022301f37540022a6603a9201d165787065637420536f6d65286f7261636c655f696e70757429203d0a202020207265666572656e63655f696e707574730a2020202020207c3e206c6973742e66696e64280a20202020202020202020666e287265665f696e7075743a20496e70757429207b0a2020202020202020202020207175616e746974795f6f66287265665f696e7075742e6f75747075742e76616c75652c206f7261636c655f6e66742e3173742c206f7261636c655f6e66742e326e6429203d3d20310a202020202020202020207d2c0a202020202020202029001633006375860420144602066644464a666040602860446ea8004520001375a604c60466ea8004c94ccc080c050c088dd50008a60103d87a8000132330010013756604e60486ea8008894ccc098004530103d87a80001323332225333026337220100062a66604c66e3c02000c4c048cc0acdd400125eb80530103d87a8000133006006001375c604a0026eb4c098004c0a8008c0a0004c8cc004004010894ccc0940045300103d87a80001323332225333025337220100062a66604a66e3c02000c4c044cc0a8dd300125eb80530103d87a8000133006006001375c60480026eacc094004c0a4008c09c004dd59802980f9baa3005301f37540026eb8c01805cdd7180280b911299980e9802980f9baa003132533302200100213253333330270011325333024001004132533333302900115333025302800213330080031325333022300a0011325333027001007132533333302c00115333028302b0021325333025300d001132533302a00100a132533333302f0011533302b302e002133300e00100c00b00b00b00b00b00b302c001302837540042a66604a6032002264a666054002014264a66666605e00201601601626464a66605a00201a264a66666606400201c01c01c26464a666060002020264a66666606a002022022022264a666064606a0060260246eb4004044c0c8004c0c800cdd6800807181780098178019bad00100b302c00130283754004012604c6ea8004020020020020020c0a4004c094dd50010a999811180b0008a99981318129baa0020070060063023375400200a00a00a00a00a00a604c002604c004006006006006604800260406ea800c004888c94ccc074c0140044c94ccc08800400c4c94cccccc09c0040100100100104c94ccc090c09c00c018014dd7000981200098101baa0041533301d30110011325333022001003132533333302700100400400400413253330243027003006005375c002604800260406ea8010008c078dd50019b87480008c078c07c0048c07400488c8cc00400400c894ccc0740045300103d87a800013322533301b300500213007330200024bd70099802002000980f80098100009ba548000dd5980c980d180d180d0011bac301800230180013013375400e60280026028602a00260206ea8008dc3a40042c602260240066020004601e004601e00260146ea800452615330084911856616c696461746f722072657475726e65642066616c7365001365637580022a6600892154657870656374205b28706f6c6963795f69642c207265665f61737365745f6e616d652c205f295d203d0a20202020202076616c75655f746f6b656e73286f776e5f696e7075742e6f75747075742e76616c7565290016153300349147657870656374205b286f6e6c795f6275726e5f706f6c6963792c205f2c206f6e6c795f6275726e5f7175616e74697479295d203d2076616c75655f746f6b656e73286d696e7429001615330024913a657870656374206f7261636c655f696e7075745f646174756d3a204f7261636c65446174756d203d206f7261636c655f696e7075745f6461746100165734ae7155ceaab9e5573eae815d0aba257489812b9f581cf41e73a239a72e0cec48792ac3fb68b0f3381494e587f8692ad80caf4a6f7261636c655f6e6674ff0001f5f6",
      //   bounty.txHash,
      //   bounty.outputIndex
      // );
      await redeemBountyToken(bounty, wallet);

      console.log(`User signed to contribute to ${bounty.name}`);
      setIsModalOpen(false);
    } catch (error) {
      console.error("Error minting bounty token:", error);
    }
  };

  return (
    <>
      <button
        type="button"
        className="text-white bg-gray-800 hover:bg-gray-900 focus:outline-none focus:ring-4 focus:ring-gray-300 font-semibold rounded-lg text-base px-6 py-3 transition duration-200 ease-in-out"
        onClick={handleContributeClick}
      >
        Contribute
      </button>

      {isModalOpen && (
        <div
          id="crud-modal"
          tabIndex={-1}
          className="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
          aria-hidden="true"
        >
          <div className="relative p-4 w-full max-w-md max-h-full">
            <div className="relative bg-gray-800 rounded-lg shadow dark:bg-gray-700">
              <div className="flex items-center justify-between p-4 border-b border-gray-600 rounded-t dark:border-gray-500">
                <h3 className="text-xl font-semibold text-gray-200">
                  Do You Want to Contribute?
                </h3>
                <button
                  type="button"
                  className="text-gray-400 bg-transparent hover:bg-gray-600 hover:text-white rounded-lg text-sm w-8 h-8"
                  onClick={handleCloseModal}
                >
                  <svg
                    className="w-3 h-3"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 14 14"
                  >
                    <path
                      stroke="currentColor"
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth="2"
                      d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
                    />
                  </svg>
                  <span className="sr-only">Close modal</span>
                </button>
              </div>
              <form className="p-4" onSubmit={handleConfirm}>
                <div className="mb-4 text-gray-300">
                  <div className="mb-2 flex items-center justify-center">
                    <label className="block text-sm font-medium mr-2">
                      Bounty:
                    </label>{" "}
                    <strong>{bounty.name}</strong>
                  </div>
                  <div className="mb-2 flex items-center justify-center">
                    <label className="block text-sm font-medium mr-2">
                      Task:
                    </label>
                    <a
                      href={bounty.issue_url}
                      className="text-blue-400 hover:underline"
                    >
                      {bounty.issue_url}
                    </a>
                  </div>
                  <div className="mb-2 flex items-center justify-center">
                    <label className="block text-sm font-medium mr-2">
                      Reward:
                    </label>{" "}
                    <span>{bounty.reward}</span>
                  </div>
                  {/* <div className="mb-4">
                    <label className="block text-sm font-medium">
                      Owners
                    </label>
                    <span>{bounty.required_signatories.join(", ")}</span>
                  </div> */}
                </div>

                <div className="mt-6 flex justify-center space-x-4">
                  <button
                    type="submit"
                    className="text-white inline-flex items-center bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5"
                  >
                    Confirm
                  </button>
                  <button
                    type="button"
                    className="text-white bg-gray-700 hover:bg-gray-600 focus:outline-none focus:ring-4 focus:ring-gray-500 font-medium rounded-lg text-sm px-5 py-2.5"
                    onClick={handleCloseModal}
                  >
                    Cancel
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      )}
    </>
  );
};

export default Contribute;
